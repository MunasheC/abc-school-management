{
	"info": {
		"name": "School Management System - User Journey Tests",
		"description": "Complete test collection for all 8 user journeys",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "schoolId",
			"value": "1",
			"type": "string"
		},
		{
			"key": "studentRef",
			"value": "",
			"type": "string"
		},
		{
			"key": "studentId",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "JOURNEY 1 - Bank Onboards School",
			"item": [
				{
					"name": "1.1 Create New School",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set('schoolId', jsonData.id);",
									"    pm.test('School created successfully', function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"    pm.test('School has ID', function () {",
									"        pm.expect(jsonData.id).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"schoolName\": \"Churchill High School\",\n    \"schoolCode\": \"CHHS001\",\n    \"headTeacherName\": \"Mr. Robert Mutasa\",\n    \"primaryPhone\": \"0771234567\",\n    \"email\": \"admin@churchill.ac.zw\",\n    \"physicalAddress\": \"123 Main Road, Harare\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/bank/admin/schools",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"admin",
								"schools"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.2 Get All Schools",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Returns array of schools', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/bank/admin/schools",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"admin",
								"schools"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 2 - School Creates Student",
			"item": [
				{
					"name": "2.1 Create Student with School Context",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set('studentId', jsonData.id);",
									"    pm.collectionVariables.set('studentRef', jsonData.studentReference);",
									"    pm.test('Student created successfully', function () {",
									"        pm.response.to.have.status(201);",
									"    });",
									"    pm.test('Student has reference', function () {",
									"        pm.expect(jsonData.studentReference).to.exist;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"firstName\": \"Alice\",\n    \"lastName\": \"Moyo\",\n    \"dateOfBirth\": \"2010-05-15\",\n    \"gender\": \"FEMALE\",\n    \"grade\": \"Form 3\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/school/students",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.2 Get All Students for School",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Returns array of students', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/students",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 3 - Bank Counter Payment",
			"item": [
				{
					"name": "3.1 Lookup Student by Reference",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Student found', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.studentName).to.exist;",
									"    pm.expect(jsonData.outstandingBalance).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"studentReference\": \"{{studentRef}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/bank/lookup",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"lookup"
							]
						}
					},
					"response": []
				},
				{
					"name": "3.2 Process Counter Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Payment processed', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.amount).to.equal(200);",
									"    pm.expect(jsonData.paymentMethod).to.equal('Bank Counter');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"studentReference\": \"{{studentRef}}\",\n    \"amount\": 200.00,\n    \"bankBranch\": \"Branch 005 - Harare Central\",\n    \"tellerName\": \"John Ncube\",\n    \"bankTransactionId\": \"BNK-TXN-{{$timestamp}}\",\n    \"parentAccountNumber\": \"ACC123456\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/bank/payment/counter",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"payment",
								"counter"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 4 - Mobile Payment",
			"item": [
				{
					"name": "4.1 Process Mobile Banking Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Mobile payment processed', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.amount).to.equal(150);",
									"    pm.expect(jsonData.paymentMethod).to.equal('Bank Digital Channel');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"studentReference\": \"{{studentRef}}\",\n    \"amount\": 150.00,\n    \"digitalChannel\": \"Mobile Banking App\",\n    \"bankTransactionId\": \"MOB-TXN-{{$timestamp}}\",\n    \"parentAccountNumber\": \"ACC123456\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/bank/payment/digital",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"payment",
								"digital"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 5 - School Views Collections",
			"item": [
				{
					"name": "5.1 Get Today's Payments",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Returns payment array', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/payments/today",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"payments",
								"today"
							]
						}
					},
					"response": []
				},
				{
					"name": "5.2 Get Payment Statistics",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Has statistics', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.totalCollected).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/payments/reports/statistics",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"payments",
								"reports",
								"statistics"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 6 - Data Isolation Test",
			"item": [
				{
					"name": "6.1 Get Students for School 1",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Returns students for School 1', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"    console.log('School 1 has ' + jsonData.length + ' students');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "1",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/students",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students"
							]
						}
					},
					"response": []
				},
				{
					"name": "6.2 Get Students for School 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200, 401, or 404', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 401, 404]);",
									"});",
									"if (pm.response.code === 401) {",
									"    console.log('School 2 not onboarded yet - expected behavior');",
									"}",
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    console.log('School 2 has ' + jsonData.length + ' students');",
									"    pm.test('Data isolation verified - different results', function () {",
									"        pm.expect(jsonData).to.be.an('array');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "2",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/students",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students"
							]
						}
					},
					"response": []
				},
				{
					"name": "6.3 Try Access Without School Context",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Should return 401 without school context', function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/school/students",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 7 - Bank Analytics Dashboard",
			"item": [
				{
					"name": "7.1 Get Cross-School Analytics",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Has analytics data', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.totalSchools).to.exist;",
									"    pm.expect(jsonData.totalStudents).to.exist;",
									"    pm.expect(jsonData.totalRevenueAllTime).to.exist;",
									"    console.log('Total Schools: ' + jsonData.totalSchools);",
									"    console.log('Total Students: ' + jsonData.totalStudents);",
									"    console.log('All-Time Revenue: $' + jsonData.totalRevenueAllTime);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/bank/admin/analytics",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"admin",
								"analytics"
							]
						}
					},
					"response": []
				},
				{
					"name": "7.2 Get Revenue Trend (30 days)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Returns trend data', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"    console.log('Revenue trend data points: ' + jsonData.length);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/bank/admin/analytics/revenue-trend",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"admin",
								"analytics",
								"revenue-trend"
							]
						}
					},
					"response": []
				},
				{
					"name": "7.3 Get School Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Has school details', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.school).to.exist;",
									"    pm.expect(jsonData.totalStudents).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/bank/admin/schools/{{schoolId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"bank",
								"admin",
								"schools",
								"{{schoolId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "JOURNEY 8 - Additional Tests",
			"item": [
				{
					"name": "8.1 Search Students by Name",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Search results returned', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/students/search?name=Alice",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students",
								"search"
							],
							"query": [
								{
									"key": "name",
									"value": "Alice"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "8.2 Get Student Fee Record",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Fee record exists', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.grossAmount).to.exist;",
									"    pm.expect(jsonData.outstandingBalance).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/students/{{studentId}}/fees",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"students",
								"{{studentId}}",
								"fees"
							]
						}
					},
					"response": []
				},
				{
					"name": "8.3 Get Guardians",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"pm.test('Guardians list returned', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "X-School-Id",
								"value": "{{schoolId}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/school/guardians",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"school",
								"guardians"
							]
						}
					},
					"response": []
				}
			]
		}
	]
}
